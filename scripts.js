// üìÅ –î–∞–Ω–Ω—ã–µ: –û–±—ä–µ–∫—Ç—ã
const objectData = [
  {
    id: 1,
    name: "–î–≤–æ—Ä–æ–≤–∞—è —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è –ø–æ –∞–¥—Ä–µ—Å—É: –ü—É—Ç–µ–≤–æ–π –ø—Ä. 38",
    objectId: "1004466",
    oghId: "403405",
    year: 2024,
    district: "–°–í–ê–û",
    performer: "–ê–î",
    responsible: "–ê–Ω–¥—Ä–µ–µ–≤ –Æ.–ê",
    startDate: "15.04.2024",
    endDate: "25.08.2024",
    progress: "100",
    _children: [
      {
        name: "–†–µ–º–æ–Ω—Ç –ø–æ–∫—Ä—ã—Ç–∏—è –∞—Å—Ñ–∞–ª—å—Ç–æ–±–µ—Ç–æ–Ω–Ω–æ–≥–æ –ø—Ä–æ–µ–∑–¥–∞ –≤ —Ä–∞–º–∫–∞—Ö –±–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏",
        objectId: "1004466",
        oghId: "403405",
        year: 2024,
        district: "–°–í–ê–û",
        performer: "–ê–î",
        responsible: "–ê–Ω–¥—Ä–µ–µ–≤ –Æ.–ê",
        startDate: "15.04.2024",
        endDate: "25.04.2024",
        progress: "100",
      },
      {
        name: "–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ–∫—Ä—ã—Ç–∏—è –∞—Å—Ñ–∞–ª—å—Ç–æ–±–µ—Ç–æ–Ω–Ω–æ–≥–æ –ø—Ä–æ–µ–∑–¥–∞ –≤ —Ä–∞–º–∫–∞—Ö –±–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏",
        objectId: "1004466",
        oghId: "403405",
        year: 2024,
        district: "–°–í–ê–û",
        performer: "–ê–î",
        responsible: "–ê–Ω–¥—Ä–µ–µ–≤ –Æ.–ê",
        startDate: "25.04.2024",
        endDate: "11.05.2024",
        progress: "100",
      },
      {
        name: "–†–µ–º–æ–Ω—Ç –ø–æ–∫—Ä—ã—Ç–∏—è –∞—Å—Ñ–∞–ª—å—Ç–æ–±–µ—Ç–æ–Ω–Ω–æ–≥–æ —Ç—Ä–æ—Ç—É–∞—Ä–∞ –≤ —Ä–∞–º–∫–∞—Ö –±–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏",
        objectId: "1004466",
        oghId: "403405",
        year: 2024,
        district: "–°–í–ê–û",
        performer: "–ê–î",
        responsible: "–ê–Ω–¥—Ä–µ–µ–≤ –Æ.–ê",
        startDate: "11.05.2024",
        endDate: "28.05.2024",
        progress: "100",
      },
      {
        name: "–ó–∞–º–µ–Ω–∞ –¥–æ—Ä–æ–∂–Ω–æ–≥–æ –±–æ—Ä—Ç–æ–≤–æ–≥–æ –∫–∞–º–Ω—è –≤ —Ä–∞–º–∫–∞—Ö –±–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏",
        objectId: "1004466",
        oghId: "403405",
        year: 2024,
        district: "–°–í–ê–û",
        performer: "–ê–î",
        responsible: "–ê–Ω–¥—Ä–µ–µ–≤ –Æ.–ê",
        startDate: "28.05.2024",
        endDate: "15.06.2024",
        progress: "100",
      },
      {
        name: "–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –¥–æ—Ä–æ–∂–Ω–æ–≥–æ –±–æ—Ä—Ç–æ–≤–æ–≥–æ –∫–∞–º–Ω—è –≤ —Ä–∞–º–∫–∞—Ö –±–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏",
        objectId: "1004466",
        oghId: "403405",
        year: 2024,
        district: "–°–í–ê–û",
        performer: "–ê–î",
        responsible: "–ê–Ω–¥—Ä–µ–µ–≤ –Æ.–ê",
        startDate: "15.06.2024",
        endDate: "22.07.2024",
        progress: "100",
      },
      {
        name: "–†–µ–º–æ–Ω—Ç –ø–æ–∫—Ä—ã—Ç–∏—è –∞—Å—Ñ–∞–ª—å—Ç–æ–±–µ—Ç–æ–Ω–Ω–æ–≥–æ –∞–≤—Ç–æ–ø–∞—Ä–∫–æ–≤–∫–∏ –≤ —Ä–∞–º–∫–∞—Ö –±–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏",
        objectId: "1004466",
        oghId: "403405",
        year: 2024,
        district: "–°–í–ê–û",
        performer: "–ê–î",
        responsible: "–ê–Ω–¥—Ä–µ–µ–≤ –Æ.–ê",
        startDate: "22.07.2024",
        endDate: "25.08.2024",
        progress: "100",
      },
    ],
  },
];

// üìé –î–∞–Ω–Ω—ã–µ: –î–æ–∫—É–º–µ–Ω—Ç—ã
const documentsData = [
  {
    id: "doc-110628-1",
    name: "üìÑ –†–µ–µ—Å—Ç—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∫ –∞–∫—Ç—É",
    objectId: 110628,
    docType: "–†–µ–µ—Å—Ç—Ä",
    docNumber: "–±/–Ω",
    uploadDate: "22.09.2024",
    pageCount: 2,
    sheetNum: 566,
  },
  {
    id: "doc-110628-2",
    name: "üìÑ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∫–∞—á–µ—Å—Ç–≤–∞ (–≥–∞–∑–æ–Ω)",
    objectId: 110628,
    docType: "–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç",
    docNumber: "829413–ì–¢",
    uploadDate: "03.10.2019",
    pageCount: 2,
    sheetNum: 568,
  },
];

// üìã –ö–æ–ª–æ–Ω–∫–∏ –æ–±—ä–µ–∫—Ç–æ–≤
const objectColumns = [
  { title: "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ", field: "name", widthGrow: 2.5 },
  { title: "ID –æ–±—ä–µ–∫—Ç–∞", field: "objectId" },
  { title: "ID –û–ì–•", field: "oghId" },
  { title: "–ì–æ–¥", field: "year" },
  { title: "–û–∫—Ä—É–≥", field: "district" },
  { title: "–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å", field: "performer" },
  { title: "–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π", field: "responsible" },
  { title: "–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞", field: "startDate" },
  { title: "–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è", field: "endDate" },
  { title: "% –ó–∞–≤–µ—Ä—à–µ–Ω–∏—è", field: "progress" },
];

// üìã –ö–æ–ª–æ–Ω–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
const documentColumns = [
  { title: "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ", field: "name", widthGrow: 2 },
  { title: "–ù–æ–º–µ—Ä", field: "docNumber" },
  { title: "–î–∞—Ç–∞", field: "uploadDate" },
  { title: "–¢–∏–ø", field: "docType" },
  { title: "ID –æ–±—ä–µ–∫—Ç–∞", field: "objectId" },
  { title: "–ö–æ–ª-–≤–æ –ª–∏—Å—Ç–æ–≤", field: "pageCount" },
  { title: "–õ–∏—Å—Ç ‚Ññ", field: "sheetNum" },
];

// üöÄ –û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—É—Å–∫
document.addEventListener("DOMContentLoaded", () => {
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã –æ–±—ä–µ–∫—Ç–æ–≤
  const tableObjects = new Tabulator("#table-objects", {
    data: objectData,
    layout: "fitColumns",
    height: 850,
    placeholder: "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö",
    dataTree: true,
    dataTreeStartExpanded: false,
    dataTreeChildField: "_children",
    dataTreeCollapseElement: "<span style='margin-right:2px;'>‚ñº</span>",
    dataTreeExpandElement: "<span style='margin-right:2px;'>‚ñ∂</span>",
    headerSort: false,
    columns: objectColumns,
  });

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
  const tableDocuments = new Tabulator("#table-documents", {
    data: documentsData,
    columns: documentColumns,
    layout: "fitDataStretch",
    height: 500,
    placeholder: "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö",
    pagination: false,
    groupBy: "objectId",
groupHeader: function(value, count, data) {
  const objectName = data[0]?.name?.split("üìÑ ")[1]?.split("(")?.[0] || `–û–±—ä–µ–∫—Ç ${value}`;
  return `<span style="margin-left: 6px;">${objectName} (${count} –¥–æ–∫—É–º–µ–Ω—Ç–∞)</span>`;
},

  });

  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
  document.querySelectorAll(".tab-btn").forEach((btn) => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".tab-btn").forEach((b) => b.classList.remove("active"));
      document.querySelectorAll(".tab-section").forEach((tab) => tab.classList.remove("active"));
      btn.classList.add("active");
      document.getElementById(btn.dataset.tab).classList.add("active");
    });
  });

// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–º—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
const savedTheme = localStorage.getItem("theme") || "dark";
document.body.classList.add(savedTheme);

document.getElementById("themeToggle").addEventListener("click", () => {
  const isDark = document.body.classList.contains("dark");
  document.body.classList.remove(isDark ? "dark" : "light");
  document.body.classList.add(isDark ? "light" : "dark");
  localStorage.setItem("theme", isDark ? "light" : "dark");
});

// üìå –§–∏–ª—å—Ç—Ä—ã –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ "–†–µ–µ—Å—Ç—Ä –æ–±—ä–µ–∫—Ç–æ–≤"
document.getElementById("filter-name").addEventListener("input", function () {
  tableObjects.setFilter("name", "like", this.value);
});
document.getElementById("filter-objectId").addEventListener("input", function () {
  tableObjects.setFilter("objectId", "like", this.value);
});
document.getElementById("filter-status").addEventListener("input", function () {
  tableObjects.setFilter("status", "like", this.value); // ‚ö†Ô∏è –ü–æ–ª—è status –≤ –∫–æ–ª–æ–Ω–∫–∞—Ö –Ω–µ—Ç
});
document.getElementById("filter-district").addEventListener("input", function () {
  tableObjects.setFilter("district", "like", this.value);
});
document.getElementById("filter-performer").addEventListener("input", function () {
  tableObjects.setFilter("performer", "like", this.value);
});
document.getElementById("filter-year").addEventListener("input", function () {
  tableObjects.setFilter("year", "like", this.value);
});
document.getElementById("filter-start").addEventListener("input", function () {
  tableObjects.setFilter("startDate", "like", this.value);
});
document.getElementById("filter-end").addEventListener("input", function () {
  tableObjects.setFilter("endDate", "like", this.value);
});
document.getElementById("filter-responsible").addEventListener("input", function () {
  tableObjects.setFilter("responsible", "like", this.value);
});



  
// üîç –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–ª—è–º
const filterInputs = {
  name: "filter-name",
  district: "filter-district",
  performer: "filter-performer",
  year: "filter-year",
  responsible: "filter-responsible",
  startDate: "filter-start",
  endDate: "filter-end",
};

Object.entries(filterInputs).forEach(([field, inputId]) => {
  const input = document.getElementById(inputId);
  if (input) {
    input.addEventListener("input", () => {
      const filters = [];

      Object.entries(filterInputs).forEach(([f, id]) => {
        const val = document.getElementById(id).value.trim();
        if (val !== "") {
          filters.push({ field: f, type: "like", value: val });
        }
      });

      tableObjects.setFilter(filters);
    });
  }
});

});
